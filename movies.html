const apiKey = '330845779e6588abc657b964887317fb'; // TMDb API key
const trendingApiUrl = `https://api.themoviedb.org/3/trending/movie/week?api_key=${apiKey}`;
const searchApiUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&language=en-US&query=`;

const searchInput = document.getElementById('search-input');
const movieList = document.getElementById('movie-list');
const trendingMoviesList = document.getElementById('trending-movies');

// Fetch Trending Movies and display them first
async function fetchTrendingMovies() {
    const response = await fetch(trendingApiUrl);
    const data = await response.json();
    const trendingMovies = data.results;
    displayMovies(trendingMovies, trendingMoviesList);
}

// Fetch and display movies based on search query
async function fetchMovies(query) {
    const response = await fetch(`${searchApiUrl}${encodeURIComponent(query)}`);
    const data = await response.json();
    const movies = data.results;
    displayMovies(movies, movieList);
}

// Function to display movie cards
function displayMovies(movies, listElement) {
    listElement.innerHTML = ''; // Clear previous results

    if (movies.length === 0) {
        listElement.innerHTML = '<p>No movies found!</p>';
        return;
    }

    movies.forEach(movie => {
        const movieItem = document.createElement('div');
        movieItem.classList.add('movie-item');
        movieItem.dataset.id = movie.id;

        const poster = `https://image.tmdb.org/t/p/w200${movie.poster_path || ''}`;
        const title = movie.title || 'Unknown Title';

        movieItem.innerHTML = `
            <img src="${poster}" alt="${title}">
            <h3>${title}</h3>
        `;

        movieItem.addEventListener('click', () => {
            openMovieInNewTab(movie.id);
        });

        listElement.appendChild(movieItem);
    });
}

// Open movie in a new tab by IMDb ID
async function openMovieInNewTab(movieId) {
    const response = await fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}`);
    const movie = await response.json();
    const imdbID = movie.imdb_id;

    if (imdbID) {
        window.open(`https://play2.123embed.net/movie/${imdbID}`, '_blank');
    } else {
        alert('No IMDb ID found for this movie.');
    }
}

// Event listeners
searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim();
    
    // If there is a query, hide the trending movies and show search results
    if (query) {
        trendingMoviesList.style.display = 'none';
        fetchMovies(query);
    } else {
        // If there's no query, show the trending movies again
        trendingMoviesList.style.display = 'block';
        movieList.innerHTML = ''; // Clear any previous search results
    }
});

// Fetch trending movies on page load
fetchTrendingMovies();
